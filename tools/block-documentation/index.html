<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Block documentation</title>
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet"
	      type="text/css"/>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.4.1/knockout-min.js"></script>
	<style>
		body {
			padding-top: 90px;
		}
	</style>
</head>
<body>
<nav class="navbar navbar-inverse navbar-fixed-top">
	<div class="container">
		<div class="navbar-header">
			<a class="navbar-brand" href="#">Block documentation</a>
		</div>
		<div id="navbar" class="collapse navbar-collapse">
			<ul class="nav navbar-nav" data-bind="foreach: Object.keys($data)">
				<li>
					<a data-bind="html: $data, attr: {'href': '#'  + $data}"></a>
				</li>
			</ul>
		</div>
	</div>
</nav>

<div class="container viewmodel">

	<div class="starter-template">
		<h2 id="blocks">Application blocks</h2>
		<div class="blocks" data-bind="foreach: blocks">
			<div class="panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title" data-bind="html: $data.blockId"></h3>
				</div>
				<div class="panel-body table-responsive">
					<table class="table table-striped">
						<thead>
						<tr data-bind="foreach: Object.keys($data.properties[0])">
							<th data-bind="html: $data"></th>
						</tr>
						</thead>
						<tbody data-bind="foreach: $data.properties">
						<tr data-bind="foreach: Object.keys($data)">
							<td>
								<!-- ko if: $data === 'type' -->
									<!-- ko if: types.indexOf($parent[$data]) > -1 -->
										<code data-bind="html: $parent[$data]"></code>
									<!-- /ko -->
									<!-- ko if: types.indexOf($parent[$data]) === -1 -->
										<a data-bind="html: $parent[$data], attr: {'href': '#' + $parent[$data]}"></a>
									<!-- /ko -->
								<!-- /ko -->
								<!-- ko if: $data === 'required' -->
								<span class="btn btn-default btn-sm disabled" data-bind="html: $parent[$data], css: {'btn-danger':  $parent[$data]}"></span>
								<!-- /ko -->
								<!-- ko if: $data !== 'type' && $data !== 'required' -->
								<span data-bind="html: $parent[$data]"></span>
								<!-- /ko -->
							</td>
						</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>

		<h2 id="references">References</h2>
		<div class="blocks" data-bind="foreach: references">
			<div class="panel panel-default" data-bind="attr: {'id': $data.name}">
				<div class="panel-heading">
					<h3 class="panel-title" data-bind="html: $data.name"></h3>
				</div>
				<div class="panel-body table-responsive">
					<table class="table table-striped">
						<thead>
						<tr data-bind="foreach: Object.keys($data.properties[0])">
							<th data-bind="html: $data"></th>
						</tr>
						</thead>
						<tbody data-bind="foreach: $data.properties">
							<tr data-bind="foreach: Object.keys($data)">
								<td>
									<!-- ko if: $data === 'type' -->
									<code data-bind="html: $parent[$data]"></code>
									<!-- /ko -->
									<!-- ko if: $data === 'required' -->
									<span class="btn btn-default btn-sm disabled"
									      data-bind="html: $parent[$data], css: {'btn-danger':  $parent[$data]}"></span>
									<!-- /ko -->
									<!-- ko if: $data !== 'type' && $data !== 'required' -->
									<span data-bind="html: $parent[$data]"></span>
									<!-- /ko -->
								</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>

</div><!-- /.container -->
<script>
	var types = ['string', 'boolean', 'Array', 'number'];

	// Check fetch support
	if( self.fetch )
	{
		// Create a simple viewmodel
		var ViewModel = function( data )
		{
			this.blocks = ko.observableArray( data.blocks );
			this.references = ko.observable( data.references );
		};

		// Create the request
		var request = new Request( 'data.json', {
			method: 'GET',
			headers: new Headers( {
				'Content-Type': 'text/plain'
			} )
		} );

		// Fetch the json file
		fetch( request )
			.then( function( response )
			{
				return response.json();
			} )
			.then( function( response )
			{
				// Apply knockout binding for rendering of the html
				ko.applyBindings( new ViewModel( response ), document.body );
			} )
	}
	else
	{
		alert( 'Fetch not supported!' );
	}
</script>
</body>
</html>