<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Block documentation</title>

	<script src="//cdnjs.cloudflare.com/ajax/libs/knockout/3.4.1/knockout-min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/default.min.css">

	<style>
		body {
			padding-top: 90px;
		}

		td .table {
			margin-left: 50px;
			width: calc(100% - 50px);
			margin-bottom: 0;
		}
	</style>
</head>
<body>
<nav class="navbar navbar-inverse navbar-fixed-top">
	<div class="container">
		<div class="navbar-header">
			<a class="navbar-brand" href="#">Block documentation</a>
		</div>
		<div id="navbar" class="collapse navbar-collapse">
			<ul class="nav navbar-nav" data-bind="foreach: Object.keys($data)">
				<li>
					<a data-bind="html: $data, attr: {'href': '#'  + $data}"></a>
				</li>
			</ul>
		</div>
	</div>
</nav>

<div class="container viewmodel">

	<div class="starter-template">
		<h2 id="blocks">Application blocks</h2>
		<div class="blocks" data-bind="foreach: blocks">
			<div class="panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title" data-bind="html: $data.blockId"></h3>
				</div>
				<div class="panel-body table-responsive">
					<!-- ko template: {name: 'table', data: $data.properties} --><!--/ko -->
				</div>
				<div class="panel-body panel-responsive">
					<h5>Example JSON</h5>
					<pre><code class="json-example" data-bind="html: $data.example"></code></pre>
				</div>
			</div>
		</div>

		<h2 id="references">Object references</h2>
		<div class="blocks" data-bind="foreach: references">
			<div class="panel panel-default" data-bind="attr: {'id': $data.name}">
				<div class="panel-heading">
					<h3 class="panel-title" data-bind="html: $data.name"></h3>
				</div>
				<div class="panel-body table-responsive">
					<!-- ko template: {name: 'table', data: $data.properties} --><!--/ko -->
				</div>
			</div>
		</div>

		<h2 id="enums">Enum references</h2>
		<div class="blocks" data-bind="foreach: enums">
			<div class="panel panel-default" data-bind="attr: {'id': $data.name}">
				<div class="panel-heading">
					<h3 class="panel-title" data-bind="html: $data.name"></h3>
				</div>
				<div class="panel-body table-responsive">
					<!-- ko template: {name: 'table', data: $data.properties} --><!--/ko -->
				</div>
			</div>
		</div>
	</div>

	<script type="text/html" id="table">
		<table class="table">
			<thead>
				<tr data-bind="foreach: Object.keys($data[0])">
					<!-- ko if: $data !== 'properties' -->
						<th data-bind="html: $data"></th>
					<!-- /ko -->
				</tr>
			</thead>
			<tbody data-bind="foreach: $data">

				<tr data-bind="foreach: Object.keys($data)">

					<!-- ko if: $data !== 'properties' -->

						<td>
							<!-- ko if: $data === 'value' -->
								<code data-bind="html: $parent[$data]"></code>
							<!-- /ko -->

							<!-- ko if: $data === 'type' -->

								<!-- ko if: types.indexOf($parent[$data]) > -1 -->
									<code data-bind="text: $parent[$data]"></code>
								<!-- /ko -->

								<!-- ko if: types.indexOf($parent[$data]) === -1 -->
									<a data-bind="text: $parent[$data], attr: {'href': '#' + $parent[$data]}"></a>
								<!-- /ko -->

							<!-- /ko -->

							<!-- ko if: $data === 'required' -->
								<span class="btn btn-default btn-sm disabled" data-bind="text: $parent[$data], css: {'btn-danger':  $parent[$data]}"></span>
							<!-- /ko -->

							<!-- ko if: $data !== 'value' && $data !== 'type' && $data !== 'required' -->
								<span data-bind="html: $parent[$data]"></span>
							<!-- /ko -->
						</td>
					<!-- /ko -->
				</tr>

				<!-- ko if: $data.properties && $data.properties.length -->
					<tr>
						<td colspan="4">
							<!-- ko template: {name: 'table', data: $data.properties} --><!--/ko -->
						</td>
					</tr>
				<!-- /ko -->

			</tbody>
		</table>
</script>

</div><!-- /.container -->
<script>
	var types = ['string', 'boolean', 'Array', 'Object', 'number'];

	// Check fetch support
	if( self.fetch )
	{
		// Create a simple viewmodel
		var ViewModel = function( data )
		{
			this.blocks = ko.observableArray( data.blocks );
			this.references = ko.observableArray( data.references );
			this.enums = ko.observableArray( data.enums );
		};

		// Create the request
		var request = new Request( 'data.json', {
			method: 'GET',
			headers: new Headers( {
				'Content-Type': 'text/plain'
			} )
		} );

		// Fetch the json file
		fetch( request )
			.then( function( response )
			{
				return response.json();
			} )
			.then( function( response )
			{
				// Apply knockout binding for rendering of the html
				ko.applyBindings( new ViewModel( response ), document.body );

				document.body.querySelectorAll( '.json-example' ).forEach( function( block )
				{
					hljs.highlightBlock( block );
				} )
			} )
	}
	else
	{
		alert( 'Fetch not supported!' );
	}
</script>
</body>
</html>