id: markets
label: CSV feed of markets
migration_group: migrate_markets_map_csv
source:
  plugin: spectrum_csv
  path: 'markets_map.csv'
  # Column delimiter. Comma (,) by default.
  delimiter: ','
  # Field enclosure. Double quotation marks (") by default.
  header_row_count: 1
  keys:
    - DMAcode
  column_names:
    # So, here we're saying that the first field (index 0) on each line will
    # be stored in the start_date field in the Row object during migration, and
    # that name can be used to map the value below. "Date of game" will appear
    # in the UI to describe this field.
    0:
      State: 'State'
    1:
      DMAcode: 'DMA Code'
    2:
      DMArank: 'DMA Rank'
    3:
      DMAname: 'DMA Name'
    4:
      DMAvideo: 'DMA Video'
    5:
      Households: 'Households'
    6:
      Markets: 'Markets'
    7:
      States: 'States'
    8:
      partners_logos: 'Partners logos'
    9:
      Democomp: 'Demographic Composition'
    10:
      Devices_desk: 'Devices Desktop'
    11:
      Devices_smart: 'Devices Smartphone'
    12:
      Devices_tab: 'Devices Tablet'
    13:
      Gender_male: 'Gender Male'
    14:
      Gender_female: 'Gender Female'
    15:
      Education_no: 'Education No college'
    16:
      Education_undergrad: 'Education Undergrad'
    17:
      Education_grad: 'Education Grad+'
    18:
      Home_own: 'Home Own'
    19:
      Home_rent: 'Home Rent'
    20:
      Parenting_kids: 'Parenting Have Kids'
    21:
      Parenting_nokids: 'Parenting No Kids'
    22:
      Age_18: 'Age <18'
    23:
      Age_1824: 'Age 18-24'
    24:
      Age_2534: 'Age 25-34'
    25:
      Age_3544: 'Age 35-44'
    26:
      Age_4554: 'Age 45-54'
    27:
      Age_5564: 'Age 55-64'
    28:
      Age_65: 'Age 65+'
    29:
      Income_0_50: 'Income 0-50'
    30:
      Income_50_100: 'Income 50-100'
    31:
      Income_100_150: 'Income 100-150'
    32:
      Income_150: 'Income 150+'
    33:
      Network_logos: 'Network Logos'
    34:
      TopNetwork_logos: 'Top Network Logos'

process:
  title: DMAname
  field_market_state_code: State
  field_market_dma_code:
    plugin: skip_on_empty_null
    method: process
    source: DMAcode
    message: 'Field field_name is missing'
  field_market_dma_rank:
    plugin: skip_on_empty_null
    method: process
    source: DMArank
    message: 'Field field_name is missing'
  field_market_dma_name:
    plugin: skip_on_empty_null
    method: process
    source: DMAname
    message: 'Field field_name is missing'
  field_market_dma_video:
    plugin: skip_on_empty_null
    method: process
    source: DMAvideo
    message: 'Field field_name is missing'

  field_market_partners_logos:
    -
      plugin: skip_on_empty_null
      method: process
      source: partners_logos
      message: 'Field field_name is missing'
    -
      plugin: explode
      delimiter: ','
      source: partners_logos

  field_market_households:
    -
      plugin: skip_on_empty_null
      method: process
      source: Households
      message: 'Field field_name is missing'
    -
      plugin: remove_comma_from_thousands
  field_market_states:
    plugin: skip_on_empty_null
    method: process
    source: States
    message: 'Field field_name is missing'
  field_market_markets:
    plugin: skip_on_empty_null
    method: process
    source: Markets
    message: 'Field field_name is missing'
  field_market_media_kit:
    plugin: skip_on_empty_null
    method: process
    source: Mediakit
    message: 'Field field_name is missing'

  field_market_demog_composition/target_id:
    -
      plugin: skip_on_empty_null
      method: process
      source: Democomp
      message: 'Field field_name is missing'
    -
      plugin: file_json
      destination: 'public://markets/[date:custom:Y]-[date:custom:m]'

  field_market_devices_desktop:
    plugin: skip_on_empty_null
    method: process
    source: Devices_desk
    message: 'Field field_name is missing'
  field_market_devices_smartphone:
    plugin: skip_on_empty_null
    method: process
    source: Devices_smart
    message: 'Field field_name is missing'
  field_market_devices_tablet:
    plugin: skip_on_empty_null
    method: process
    source: Devices_tab
    message: 'Field field_name is missing'

  field_market_gender_male:
    plugin: skip_on_empty_null
    method: process
    source: Gender_male
    message: 'Field field_name is missing'
  field_market_gender_female:
    plugin: skip_on_empty_null
    method: process
    source: Gender_female
    message: 'Field field_name is missing'

  field_market_edu_no_college:
    plugin: skip_on_empty_null
    method: process
    source: Education_no
    message: 'Field field_name is missing'
  field_market_edu_undergrad:
    plugin: skip_on_empty_null
    method: process
    source: Education_undergrad
    message: 'Field field_name is missing'
  field_market_edu_grad_plus:
    plugin: skip_on_empty_null
    method: process
    source: Education_grad
    message: 'Field field_name is missing'

  field_market_home_own:
    plugin: skip_on_empty_null
    method: process
    source: Home_own
    message: 'Field field_name is missing'
  field_market_home_rent:
    plugin: skip_on_empty_null
    method: process
    source: Home_rent
    message: 'Field field_name is missing'

  field_market_parent_have_kids:
    plugin: skip_on_empty_null
    method: process
    source: Parenting_kids
    message: 'Field field_name is missing'
  field_market_parent_no_kids:
    plugin: skip_on_empty_null
    method: process
    source: Parenting_nokids
    message: 'Field field_name is missing'

  field_market_ages_lower_18:
    plugin: skip_on_empty_null
    method: process
    source: Age_18
    message: 'Field field_name is missing'
  field_market_ages_18_24:
    plugin: skip_on_empty_null
    method: process
    source: Age_1824
    message: 'Field field_name is missing'
  field_market_ages_25_34:
    plugin: skip_on_empty_null
    method: process
    source: Age_2534
    message: 'Field field_name is missing'
  field_market_ages_35_44:
    plugin: skip_on_empty_null
    method: process
    source: Age_3544
    message: 'Field field_name is missing'
  field_market_ages_45_54:
    plugin: skip_on_empty_null
    method: process
    source: Age_4554
    message: 'Field field_name is missing'
  field_market_ages_55_64:
    plugin: skip_on_empty_null
    method: process
    source: Age_5564
    message: 'Field field_name is missing'
  field_market_ages_65_plus:
    plugin: skip_on_empty_null
    method: process
    source: Age_65
    message: 'Field field_name is missing'

  # Income
  field_market_income_0_50k:
    plugin: skip_on_empty_null
    method: process
    source: Income_0_50
    message: 'Field field_name is missing'
  field_market_income_50_100k:
    plugin: skip_on_empty_null
    method: process
    source: Income_50_100
    message: 'Field field_name is missing'
  field_market_income_100_150k:
    plugin: skip_on_empty_null
    method: process
    source: Income_100_150
    message: 'Field field_name is missing'
  field_market_income_plus_150k:
    plugin: skip_on_empty_null
    method: process
    source: Income_150
    message: 'Field field_name is missing'

  field_market_network_logos:
    -
      plugin: skip_on_empty_null
      method: process
      source: Network_logos
      message: 'Field field_name is missing'
    -
      plugin: explode
      source: Network_logos
      delimiter: ','
    -
      plugin: migration_lookup
      no_stub: true
      migration: network

  field_market_top_networks:
    -
      plugin: skip_on_empty_null
      method: process
      source: TopNetwork_logos
      message: 'Field field_name is missing'
    -
      plugin: explode
      source: TopNetwork_logos
      delimiter: ','
    -
      plugin: migration_lookup
      no_stub: true
      migration: network

  type:
    plugin: default_value
    default_value: market

destination:
  plugin: 'entity:node'
migration_dependencies: null